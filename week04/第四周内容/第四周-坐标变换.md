# 1. 线性代数基础

## 1.1 坐标表示
- 
	假设$B=\{ \mathbf{b_1},\cdots,\mathbf{b_n}\}$ 是$V$ 的一个基（在我们后续的应用中$V$ 通常为 $R^2$ 或 $R^3$），$x$ 在$V$ 中，则$x$ 相对于基$B$ 的坐标是使得 $x=c_1\mathbf{b_1}+\cdots+c_n\mathbf{b_n}$ 的**权** $c_1,\cdots,c_n$ 
	列向量$[c_1,\cdots,c_n]^T$ 即为$x$ 相对于$B$ 的**坐标向量** ,用$[x]_B$ 表示。

	在一般的讨论中，常常不指明坐标对应的基，例如 "这个点的空间坐标为$\{1,2,3\}^T$" ，这是因为这种讨论中往往默认相对于 $\{\{1,0,0\}^T,\{0,1,0\}^T,\{0,0,1\}^T\}$ 这个基进行的，但是在机器人运动中往往需要讨论多个坐标系下物体的坐标，所以理解坐标和基的关系十分重要。
	![[坐标变换1.png]](.\assets\坐标示意图.png)
	如图中$P$ 点在两个坐标系下有不同的坐标，但在空间中却表示同一个点。

## 1.2 旋转矩阵
- 
	本文假设大家已经学习过线性代数，并且掌握向量旋转相关知识（如果没有学过或者忘了的同学可以阅读[旋转矩阵推导](https://www.cnblogs.com/MetaWang/p/10094784.html)，只需要看前面一小部分，理解$P^{\prime}=R\cdot P$ 是如何表示由 $P$ 到$P^{\prime}$ 的旋转，以及$R$ 的推导即可）

# 2. 位姿描述

## 2.1 位置描述
在三维空间建立了坐标系后，就可以用一个$3\times 1$ 的**位置矢量** 表示坐标系的任何点位。根据前文所述，必须规定坐标的基，这里使用$^{A}P$ 表示$P$ 点在$A$ 系下的坐标。
$$
^{A}P=
\begin{pmatrix}
p_x \\ p_y \\ p_z
\end{pmatrix}
$$

## 2.2 姿态
确定位置后，还需要描述物体的朝向，更加规范的表述为**姿态**。
![[姿态示意图.png]](.\assets\姿态示意图.png)
如图中$^{A}P$ 直接确定了操作臂手指尖之间的某点，但只有手的姿态已知后，手的空间状态才能被完全确定下来。为了描述物体的姿态，我们将物体固定在一个坐标系上，本例中即$\{B\}$ 系，若能确定$\{B\}$ 相对于$\{A\}$ 的描述，就可表示物体的姿态。

用$^{A}\hat{X}_B$ $^{A}\hat{Y}_B$ $^{A}\hat{Z}_B$ 分别表示坐标系$\{B\}$ 三轴在参考系$\{A\}$ 的单位向量。我们称这个矩阵为**旋转矩阵** ，用符号$^{A}_{B}R$ 表示，实际上它与前文提到的对向量的旋转矩阵基本相同。
$$
^{A}_{B}R=
\begin{pmatrix}
^{A}\hat{X}_{B}&^{A}\hat{Y}_B&^{A}\hat{Z}_B
\end{pmatrix}
=
\begin{pmatrix}
r_{11}&r_{12}&r_{13} \\ 
r_{21}&r_{22}&r_{23} \\
r_{31}&r_{32}&r_{33}
\end{pmatrix}
$$

由定义可知，$^{A}\hat{X}_B$ 向量的三个分量为相同参考系下的$\hat{X}_B$  与 $\hat{X}_A$，$\hat{Y}_A$，$\hat{Z}_A$ 分别相乘得到的，所以有
$$
^{A}_{B}R=
\begin{pmatrix}
^{A}\hat{X}_{B}&^{A}\hat{Y}_B&^{A}\hat{Z}_B
\end{pmatrix}
=
\begin{pmatrix}
\hat{X}_B\cdot\hat{X}_A&\hat{Y}_B\cdot\hat{X}_A&\hat{Z}_B\cdot\hat{X}_A \\ 
\hat{X}_B\cdot\hat{Y}_A&\hat{Y}_B\cdot\hat{Y}_A&\hat{Z}_B\cdot\hat{Y}_A \\
\hat{X}_B\cdot\hat{Z}_A&\hat{Y}_B\cdot\hat{Z}_A&\hat{Z}_B\cdot\hat{Z}_A
\end{pmatrix}
$$
只要在同一参考系下，两向量点乘的值不会因参考系的改变而改变，故上式等号右侧不指定参考系。若人为假定一个参考系$\{C\}$ ，则右式可写为
$$
^{A}_{B}R=
\begin{pmatrix}
\hat{X}_B\cdot\hat{X}_A&\hat{Y}_B\cdot\hat{X}_A&\hat{Z}_B\cdot\hat{X}_A \\ 
\hat{X}_B\cdot\hat{Y}_A&\hat{Y}_B\cdot\hat{Y}_A&\hat{Z}_B\cdot\hat{Y}_A \\
\hat{X}_B\cdot\hat{Z}_A&\hat{Y}_B\cdot\hat{Z}_A&\hat{Z}_B\cdot\hat{Z}_A
\end{pmatrix}
=^{C}_AR^{T}\cdot^{C}_BR
$$
$$
^{C}_AR\cdot^{A}_BR=^{C}_BR
$$
（正交矩阵，$A^{T}=A^{-1}$)
可以注意到将等式两边的$A,B$ 调换，等式仍然成立，即
$$
^{B}_{A}R=
\begin{pmatrix}
\hat{X}_A\cdot\hat{X}_B&\hat{Y}_A\cdot\hat{X}_B&\hat{Z}_A\cdot\hat{X}_B \\ 
\hat{X}_A\cdot\hat{Y}_B&\hat{Y}_A\cdot\hat{Y}_B&\hat{Z}_A\cdot\hat{Y}_B \\
\hat{X}_A\cdot\hat{Z}_B&\hat{Y}_A\cdot\hat{Z}_B&\hat{Z}_A\cdot\hat{Z}_B
\end{pmatrix}
$$
等式右侧对比等式右侧可知，两个矩阵具有转置的关系，即：
$$
^{A}_{B}R=^{B}_{A}R^{T}
$$
直观的理解就是 **$^{A}_{B}R$ 的列向量为$\{B\}$ 在$\{A\}$ 下的主轴方向向量描述，$^{A}_{B}R$ 的行向量的转置（统一为列向量）为$\{B\}$ 在$\{A\}$ 下的主轴方向向量描述**

这可能会有点绕，但是理解清楚会对坐标系之间的关系有更清晰的认识。
# 3. 位姿变换
## 3.1 旋转
一般在求解旋转后的位姿时，通常会遇到两种情况：
- 目标静止，坐标系旋转
- 坐标系静止，目标绕自身旋转

- 第一种情况：
	![[Pasted image 20230811184534.png]](.\assets\坐标示意图.png)
	设蓝色坐标系为$\{A\}$ 红色坐标系为旋转后的坐标系$\{B\}$ ，两个坐标系下$P$ 的坐标分别为 $^{A}P$，$^{B}P$ 则有
	$$
	^{C}_AR\cdot^{A}P=^{C}_BR\cdot^{B}P
	$$
	又
	$$
	^{C}_AR\cdot^{A}_BR=^{C}_BR\tag{1}
	$$
	得
	$$
	^{A}P=^{A}_BR\cdot^{B}P\tag{2}
	$$
	对比$(1),(2)$ 式可以发现，对坐标系基的旋转是左乘，对坐标的旋转是右乘 

- 第二种情况：
	这种情况为线性代数基础中旋转部分介绍的情况，将坐标点视作矢量进行旋转，即$P^{\prime}=R\cdot P$ 。
	值得注意的是此处的$R$ 没有了上下角标，这是因为该情况下旋转是在参考系静止或者说在同一参考系下完成的。书中又将该$R$ 特别称为旋转算子，其更广泛的称呼为罗德里格斯(Rodrigues)旋转矩阵。
## 3.2 平移
当坐标系不发生旋转，只产生坐标原点上的变化时，称这种变化为平移。
设$P$ 点在$\{B\}$ 中坐标为$^{B}P$ ，$\{B\}$ 相对于$\{A\}$ 的坐标原点平移了向量$P_{BORG}$ ，则$\{A\}$ 下$P$ 的坐标 $^{A}P=^{B}P+P_{BORG}$ 
![[平移示意图.png]](.\assets\平移示意图.png)

## 3.3 齐次变换
- 一般变换
	坐标系同时发生旋转和平移变换时坐标的映射关系表示如下：
	$$
	^{A}P=^{A}_BR*^{B}P+^{A}P_{BORG}\tag{3}
	$$

为了将这种变换用一个矩阵描述，引入齐次矩阵$T$ ：
$$
^{A}_BT=
\begin{pmatrix}
&^{A}_BR&&^{A}P_{BORG} \\ 
0&0&0&1
\end{pmatrix}
$$
$(3)$式写为
$$
\begin{pmatrix}
^{A}P \\ 1
\end{pmatrix}
=
\begin{pmatrix}
&^{A}_BR&&^{A}P_{BORG} \\ 
0&0&0&1
\end{pmatrix}
\begin{pmatrix}
^{B}P \\ 1
\end{pmatrix}\tag{4}
$$
这里没什么好讲解的，可以动手算一下，尝试理解这个矩阵是如何实现旋转与平移的。
与前文讨论旋转类似，$T$ 也可以作为算子在同一坐标系下对向量进行旋转和平移
$$
^{A}P_2=T^{A}P_1\tag{5}
$$
这里只是将$T$ 视为算子，实际上$T$ 为$4\times4$ 的矩阵，无法直接与坐标向量相乘，真实的计算如$(4)$ 所示。需要将坐标齐次化（可简单理解为在原来的坐标向量中添加了1）

防止大家对$T$ 的多种含义混淆，此处对$T$ 的含义作一小结：
1. 它是位姿描述。$^{A}_BT$ 表示相对于$\{A\}$ 的坐标系$\{B\}$。
2. 它是变换映射，由前述公式$(4)$可知，通过将坐标齐次化$^{A}_BT$ 可以表示同一点在不同坐标系下的映射关系，$P_B\rightarrow P_A$ 。
3. 它是变换算子，如前述公式$(4)$所示，$T$ 可表示同一坐标系下向量的旋转和平移变换。

由于矩阵乘法满足结合律，所以多个变换的齐次矩阵可以进行相乘得到，又称为**复合变换**
$$
^{A}P_2=T_1T_2T_3{\dots}T_n^{A}P_1\iff^{A}P_2=T^{A}P_1
$$
其中$T=T_1T_2T_3{\dots}T_n$ 。

同时，由于齐次矩阵$T$ ，旋转矩阵$R$ 都是可逆矩阵，故可以用其逆矩阵表示逆变换：
$$
\begin{gather}
^{A}P_2=T^{A}P_1\\
^{A}P_1={T^{-1}}{^AP_2}
\end{gather}
$$
